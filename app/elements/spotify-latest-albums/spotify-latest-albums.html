<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="spotify-latest-albums">
  <template>
    <link rel="stylesheet" href="spotify-latest-albums.css">
    <template if="{{ !items }}">
      <form layout horizontal>
        <div flex>
          <paper-input-decorator label="Enter one or more artist names, separated by commas" floatingLabel>
            <input is="core-input" name="artists">
          </paper-input-decorator>
        </div>

        <div>
          <button type="submit">Start</button>
        </div>
      </form>
    </template>

    <template repeat="{{ items }}">
      <spotify-artist artist="{{ }}" on-add-artist="{{ addArtist }}"></spotify-artist>
    </template>
  </template>
  <script>
    (function () {
      Polymer({
        ready: function() {
          var params = this.parseQuery();

          if (params.artists) {
            this.items = params.artists.split(/,/).map(function(name) {
              return { name: name.trim() };
            });
          }
        },
        parseQuery: function() {
          return window.location.search.substr(1).split(/&/).reduce(function(output, item) {
            var parts = item.split(/=/);
            var key = decodeURIComponent(parts[0]);
            var value = decodeURIComponent(parts[1]);

            output[key] = value.replace(/\+/g, ' ');

            return output;
          }, {});
        },
        addArtist: function(event, details) {
          this.items.push(details)
        }
      });
    })();
  </script>
</polymer-element>
